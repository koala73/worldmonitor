---
phase: 08-map-data-overlays
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/world-happiness.json
  - src/data/renewable-installations.json
  - src/data/conservation-wins.json
  - src/services/happiness-data.ts
  - src/services/renewable-installations.ts
  - src/services/conservation-data.ts
  - src/types/index.ts
  - src/config/panels.ts
  - src/config/variants/happy.ts
  - src/config/variants/full.ts
  - src/config/variants/tech.ts
  - src/config/variants/finance.ts
  - src/e2e/map-harness.ts
  - src/e2e/mobile-map-integration-harness.ts
autonomous: true
requirements: [MAP-03, MAP-04, MAP-05]

must_haves:
  truths:
    - "World happiness scores for ~150 countries are loadable as a Map<ISO2, score>"
    - "Species recovery zones have lat/lon coordinates for all 10 curated species"
    - "Renewable installation data provides 80-120 global entries with lat, lon, type, and capacity"
    - "Three new MapLayers keys (happiness, speciesRecovery, renewableInstallations) exist and compile across all variant configs"
  artifacts:
    - path: "src/data/world-happiness.json"
      provides: "Static curated WHR happiness scores by ISO-2 country code"
      contains: "scores"
    - path: "src/data/renewable-installations.json"
      provides: "Curated renewable energy installation locations worldwide"
      contains: "capacityMW"
    - path: "src/services/happiness-data.ts"
      provides: "Typed loader returning Map<string, number> of ISO-2 -> score"
      exports: ["fetchHappinessScores", "HappinessData"]
    - path: "src/services/renewable-installations.ts"
      provides: "Typed loader returning RenewableInstallation[]"
      exports: ["fetchRenewableInstallations", "RenewableInstallation"]
    - path: "src/services/conservation-data.ts"
      provides: "Extended SpeciesRecovery type with recoveryZone coordinates"
      contains: "recoveryZone"
  key_links:
    - from: "src/services/happiness-data.ts"
      to: "src/data/world-happiness.json"
      via: "dynamic import"
      pattern: "import.*world-happiness"
    - from: "src/services/renewable-installations.ts"
      to: "src/data/renewable-installations.json"
      via: "dynamic import"
      pattern: "import.*renewable-installations"
    - from: "src/types/index.ts"
      to: "src/config/panels.ts"
      via: "MapLayers interface compliance"
      pattern: "happiness.*boolean"
---

<objective>
Create static curated data files and typed service loaders for world happiness scores, species recovery zone coordinates, and renewable energy installation locations. Extend the MapLayers interface with three new layer keys and update all variant configs.

Purpose: Establish the data foundation that Plan 02 will consume to create Deck.gl map overlay layers.
Output: Three static JSON datasets, three typed service modules, and MapLayers type extension compiling cleanly across all variants.
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-map-data-overlays/08-RESEARCH.md
@src/types/index.ts
@src/config/panels.ts
@src/config/variants/happy.ts
@src/services/conservation-data.ts
@src/data/conservation-wins.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create world-happiness.json, renewable-installations.json, and extend conservation-wins.json with recovery zone coordinates</name>
  <files>
    src/data/world-happiness.json
    src/data/renewable-installations.json
    src/data/conservation-wins.json
  </files>
  <action>
**1. Create `src/data/world-happiness.json`** with structure:
```json
{
  "year": 2024,
  "source": "World Happiness Report 2025",
  "scores": {
    "FI": 7.736,
    "DK": 7.586,
    ...
  }
}
```

Pre-process WHR 2025 data (Cantril Ladder scores for latest year 2024) into ISO 3166-1 Alpha-2 codes. Include all ~150 countries with available data. Use these verified mappings for known mismatches: "Turkiye" -> "TR", "Czechia" -> "CZ", "Congo (Brazzaville)" -> "CG", "Congo (Kinshasa)" -> "CD", "Eswatini" -> "SZ", "State of Palestine" -> "PS", "Hong Kong S.A.R. of China" -> "HK", "Taiwan Province of China" -> "TW", "North Macedonia" -> "MK", "Ivory Coast" -> "CI", "South Korea" -> "KR", "North Korea" -> "KP". All scores are Cantril Ladder (0-10 scale). The top countries (Finland, Denmark, Iceland, Israel, Netherlands) score 7.0+; most countries in 4.5-6.5 range; bottom countries (Afghanistan, Lebanon, Sierra Leone) score 2.0-3.5.

Reference the WHR 2025 data at https://happiness-report.s3.us-east-1.amazonaws.com/2025/Data+for+Figure+2.1+(2011-2024).xlsx -- since this is Excel format and cannot be fetched at runtime, manually curate the JSON. Use the WHR 2025 published rankings for guidance on values.

**2. Create `src/data/renewable-installations.json`** as an array of 80-120 notable renewable energy installations globally:
```json
[
  {
    "id": "bhadla-solar",
    "name": "Bhadla Solar Park",
    "type": "solar",
    "capacityMW": 2245,
    "country": "IN",
    "lat": 27.5,
    "lon": 71.9,
    "status": "operational",
    "year": 2020
  },
  ...
]
```

Include a global mix: ~40 solar farms, ~30 wind farms, ~15 hydro stations, ~5 geothermal sites, spread across all continents. Target utility-scale only (>100MW for solar/wind, >500MW for hydro). Include major recent installations: Bhadla Solar Park (India), Tengger Desert Solar (China), Noor Ouarzazate (Morocco), Hornsea (UK), Gansu Wind Farm (China), Alta Wind (USA), Three Gorges Dam (China), Itaipu Dam (Brazil/Paraguay), Geysers Geothermal (USA), Hellisheidi (Iceland), etc.

Types: "solar" | "wind" | "hydro" | "geothermal". Status: "operational" | "under_construction".

**3. Extend `src/data/conservation-wins.json`** by adding a `recoveryZone` object to each of the 10 existing species entries:
```json
"recoveryZone": {
  "name": "Chesapeake Bay, USA",
  "lat": 38.5,
  "lon": -76.4
}
```

Use the coordinates from research (08-RESEARCH.md "Proposed coordinate additions" table):
- Bald Eagle: Chesapeake Bay, USA (38.5, -76.4)
- Humpback Whale: Hawaii, USA (20.8, -156.3)
- Giant Panda: Sichuan, China (30.8, 103.0)
- Southern White Rhino: Kruger NP, South Africa (-24.0, 31.5)
- Gray Wolf: Yellowstone, USA (44.6, -110.5)
- Peregrine Falcon: Rocky Mountains, USA (39.7, -105.2)
- American Alligator: Everglades, USA (25.3, -80.9)
- Arabian Oryx: Abu Dhabi, UAE (24.2, 55.5)
- California Condor: Grand Canyon, USA (36.1, -112.1)
- Mountain Gorilla: Virunga, DRC/Rwanda (-1.5, 29.5)

Do NOT change any existing fields in conservation-wins.json -- only add the `recoveryZone` object to each entry.
  </action>
  <verify>
Validate JSON files parse correctly:
```bash
node -e "const d = require('./src/data/world-happiness.json'); console.log('Happiness:', Object.keys(d.scores).length, 'countries')"
node -e "const d = require('./src/data/renewable-installations.json'); console.log('Installations:', d.length)"
node -e "const d = require('./src/data/conservation-wins.json'); console.log('Species with zones:', d.filter(s => s.recoveryZone).length)"
```
All three should output valid counts (150+ countries, 80+ installations, 10 species with zones).
  </verify>
  <done>
Three static JSON files exist with valid data: world-happiness.json has ~150 ISO-2 keyed scores, renewable-installations.json has 80+ entries with lat/lon/type, conservation-wins.json has recoveryZone on all 10 species.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create service loaders, extend SpeciesRecovery type, and add MapLayers keys to all variant configs</name>
  <files>
    src/services/happiness-data.ts
    src/services/renewable-installations.ts
    src/services/conservation-data.ts
    src/types/index.ts
    src/config/panels.ts
    src/config/variants/happy.ts
    src/config/variants/full.ts
    src/config/variants/tech.ts
    src/config/variants/finance.ts
    src/e2e/map-harness.ts
    src/e2e/mobile-map-integration-harness.ts
  </files>
  <action>
**1. Create `src/services/happiness-data.ts`:**
```typescript
export interface HappinessData {
  year: number;
  source: string;
  scores: Map<string, number>; // ISO-2 code -> Cantril Ladder score (0-10)
}

export async function fetchHappinessScores(): Promise<HappinessData> {
  const { default: raw } = await import('@/data/world-happiness.json');
  return {
    year: raw.year,
    source: raw.source,
    scores: new Map(Object.entries(raw.scores)),
  };
}
```
Follow the exact same dynamic import + code-splitting pattern as `conservation-data.ts`.

**2. Create `src/services/renewable-installations.ts`:**
```typescript
export interface RenewableInstallation {
  id: string;
  name: string;
  type: 'solar' | 'wind' | 'hydro' | 'geothermal';
  capacityMW: number;
  country: string;  // ISO-2
  lat: number;
  lon: number;
  status: 'operational' | 'under_construction';
  year: number;
}

export async function fetchRenewableInstallations(): Promise<RenewableInstallation[]> {
  const { default: data } = await import('@/data/renewable-installations.json');
  return data as RenewableInstallation[];
}
```

**3. Update `src/services/conservation-data.ts`:**
Add `recoveryZone` to the `SpeciesRecovery` interface:
```typescript
recoveryZone?: {
  name: string;
  lat: number;
  lon: number;
};
```
Add as an optional field after the existing `lastUpdated` field. Do NOT change `fetchConservationWins()` -- it already returns the full JSON including new fields.

**4. Extend MapLayers interface in `src/types/index.ts`:**
Add three new boolean keys in the `// Happy variant layers` section, after `kindness`:
```typescript
  // Happy variant layers
  positiveEvents: boolean;
  kindness: boolean;
  happiness: boolean;
  speciesRecovery: boolean;
  renewableInstallations: boolean;
```

**5. Update ALL MapLayers configs** to include the three new keys:
- `src/config/panels.ts`: Add `happiness: false, speciesRecovery: false, renewableInstallations: false` to FULL_MAP_LAYERS, FULL_MOBILE_MAP_LAYERS, TECH_MAP_LAYERS, TECH_MOBILE_MAP_LAYERS, FINANCE_MAP_LAYERS, FINANCE_MOBILE_MAP_LAYERS. For HAPPY_MAP_LAYERS: `happiness: true, speciesRecovery: false, renewableInstallations: false` (happiness on by default per research recommendation; species/energy off by default to avoid visual clutter). For HAPPY_MOBILE_MAP_LAYERS: same as HAPPY_MAP_LAYERS.
- `src/config/variants/happy.ts`: Add `happiness: true, speciesRecovery: false, renewableInstallations: false` to both DEFAULT_MAP_LAYERS and MOBILE_DEFAULT_MAP_LAYERS.
- `src/config/variants/full.ts`: Add `happiness: false, speciesRecovery: false, renewableInstallations: false` to both configs.
- `src/config/variants/tech.ts`: Same as full.
- `src/config/variants/finance.ts`: Same as full.
- `src/e2e/map-harness.ts`: Add three keys set to `false` in allLayersEnabled and allLayersDisabled objects.
- `src/e2e/mobile-map-integration-harness.ts`: Add three keys set to `false` in the layers object.

This follows the exact Phase 4 (04-01) pattern: add keys to MapLayers interface, set true only in happy configs where appropriate, false everywhere else.
  </action>
  <verify>
```bash
npx tsc --noEmit
```
Must pass with zero errors. All 11 files referencing MapLayers must satisfy the extended interface.
  </verify>
  <done>
Three service files exist with typed loaders. SpeciesRecovery has recoveryZone field. MapLayers interface has happiness, speciesRecovery, renewableInstallations keys. All variant configs compile cleanly. `npx tsc --noEmit` passes.
  </done>
</task>

</tasks>

<verification>
1. All three JSON data files parse without errors
2. `npx tsc --noEmit` passes (MapLayers interface satisfied everywhere)
3. `fetchHappinessScores()` returns a Map with 150+ entries
4. `fetchRenewableInstallations()` returns an array with 80+ entries
5. `fetchConservationWins()` returns entries with `recoveryZone` objects
</verification>

<success_criteria>
- world-happiness.json contains ~150 country happiness scores keyed by ISO-2 codes
- renewable-installations.json contains 80+ notable installations with lat/lon/type/capacity
- conservation-wins.json has recoveryZone coordinates on all 10 species
- Three typed service modules exist with async loaders following the dynamic import pattern
- MapLayers interface has three new boolean keys compiling across all 11+ files
- TypeScript compilation succeeds with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-map-data-overlays/08-01-SUMMARY.md`
</output>
