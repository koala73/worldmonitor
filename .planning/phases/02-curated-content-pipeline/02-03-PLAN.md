---
phase: 02-curated-content-pipeline
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.ts
autonomous: true
gap_closure: true
requirements:
  - FEED-04

must_haves:
  truths:
    - "Every news story ingested by the happy variant has its happyCategory field set to one of the six content categories at runtime"
    - "classifyNewsItem() is called during news ingestion for the happy variant, not left as dead code"
  artifacts:
    - path: "src/App.ts"
      provides: "Happy variant classification wiring in loadNewsCategory"
      contains: "classifyNewsItem"
  key_links:
    - from: "src/App.ts"
      to: "src/services/positive-classifier.ts"
      via: "import and call classifyNewsItem() in loadNewsCategory()"
      pattern: "classifyNewsItem\\(.*source.*title"
---

<objective>
Wire the existing classifyNewsItem() function into the news ingestion pipeline so that every story loaded by the happy variant gets its happyCategory field populated at runtime.

Purpose: The classifier and type extension exist (from Plan 02-02) but are never invoked. ROADMAP Phase 2 Success Criterion #3 requires every ingested story to be tagged with a content category. This gap closure adds a single post-processing step in loadNewsCategory() to close that wiring gap.

Output: Modified `src/App.ts` with classification wiring for happy variant.
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-curated-content-pipeline/02-VERIFICATION.md
@.planning/phases/02-curated-content-pipeline/02-02-SUMMARY.md
@src/App.ts
@src/services/positive-classifier.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire classifyNewsItem into loadNewsCategory for happy variant</name>
  <files>src/App.ts</files>
  <action>
**Step 1: Add import for classifyNewsItem**

At the top of `src/App.ts`, add a new import line after the existing service imports (around line 20, near other `@/services/*` imports):

```typescript
import { classifyNewsItem } from '@/services/positive-classifier';
```

**Step 2: Add classification map() in loadNewsCategory()**

In `loadNewsCategory()` (line 3327), after the `fetchCategoryFeeds()` call resolves and returns `items` (line 3375-3380), and BEFORE the items are used for rendering (line 3382), add a conditional classification step for the happy variant:

```typescript
// After line 3380 (const items = await fetchCategoryFeeds(...)):
// Tag items with content categories for happy variant
if (SITE_VARIANT === 'happy') {
  for (const item of items) {
    item.happyCategory = classifyNewsItem(item.source, item.title);
  }
}
```

Use a `for...of` loop (not `.map()`) since we are mutating items in-place, not creating a new array. The `items` array is already allocated and referenced by `pendingItems` and `scheduleRender`, so in-place mutation is the correct approach.

Place this block between line 3380 (`});` closing the fetchCategoryFeeds call) and line 3382 (`this.renderNewsForCategory(category, items);`).

`SITE_VARIANT` is already imported at line 13 from `@/config`. No additional config import needed.

**What NOT to do:**
- Do NOT modify positive-classifier.ts (it is already complete and correct)
- Do NOT modify src/types/index.ts (happyCategory field already exists)
- Do NOT add classification to the `onBatch` callback -- that handles progressive rendering of partial results; the final classification on the complete `items` array is sufficient since `renderNewsForCategory` is called again at line 3382 with the full set
  </action>
  <verify>
1. `npx tsc --noEmit` passes with zero errors
2. `grep -n "classifyNewsItem" src/App.ts` shows the import and the call site in loadNewsCategory
3. `grep -n "SITE_VARIANT === 'happy'" src/App.ts` shows the conditional guard around classification
4. `VITE_VARIANT=happy npx vite build --mode development 2>&1 | tail -5` succeeds (happy variant builds)
  </verify>
  <done>
classifyNewsItem() is imported and called in loadNewsCategory() when SITE_VARIANT === 'happy'. Every NewsItem returned by fetchCategoryFeeds() has its happyCategory field set before rendering. The orphaned classifier module is now wired into the ingestion pipeline.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- zero type errors
2. `classifyNewsItem` is imported in App.ts (not just defined in positive-classifier.ts)
3. `classifyNewsItem` is called inside `loadNewsCategory()` with guard `SITE_VARIANT === 'happy'`
4. Items returned from `loadNewsCategory()` have `happyCategory` set for the happy variant
5. Happy variant build succeeds
</verification>

<success_criteria>
- classifyNewsItem() is no longer orphaned dead code -- it is imported and invoked during ingestion
- Every news item loaded by the happy variant has happyCategory populated with one of the six content categories
- No changes to non-happy variant behavior (classification is guarded by SITE_VARIANT check)
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-curated-content-pipeline/02-03-SUMMARY.md`
</output>
